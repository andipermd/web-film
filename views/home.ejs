<%- include('layouts/nav') %>

    <div class="swiper-container z-1">
        <div class="swiper-wrapper">
            <% movies.forEach((e, i)=> { %>
                <div class="swiper-slide">
                    <img src="https://image.tmdb.org/t/p/original/<%= e.backdrop_path%>" alt="Slide <%= i + 1 %>">
                </div>
                <% }) %>
        </div>
        <!-- Navigasi panah -->
        <div class="swiper-button-next z-1">
            <i class="bi bi-arrow-right-circle-fill"></i>
        </div>
        <div class="swiper-button-prev z-1">
            <i class="bi bi-arrow-left-circle-fill"></i>
        </div>
        <!-- Indikator -->
        <div class="swiper-pagination z-1"></div>

    </div>

    <div class="swiper-container-card">
        <h1>NOW SHOWING IN CINEMAS</h1>
        <div class="swiper-wrapper">
            <% movies.forEach((e, i)=> { %>
                <div class="swiper-slide">

                    <a href="/movie/<%= e.id %>" class="card text-decoration-none ">
                        <img src="https://image.tmdb.org/t/p/original/<%= e.poster_path %>" class="card-img-top" alt="">
                        <div class="card-body">
                            <h5 class="card-title">
                                <%= e.original_title %>
                            </h5>
                        </div>
                    </a>

                </div>
                <% }) %>
        </div>

        <!-- Bungkus tombol dan pagination dengan flexbox -->
        <div class="swiper-navigation-wrapper">
            <div class="swiper-button-prev swiper-button-prev-card">
                <i class="bi bi-arrow-left-circle"></i>
            </div>
            <div class="swiper-pagination swiper-pagination-card"></div>
            <div class="swiper-button-next swiper-button-next-card">
                <i class="bi bi-arrow-right-circle"></i>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row mt-5">
            <div class="col">
                <h1> Lets Now Your Favorite Movies</h1>
            </div>
        </div>

        <!-- input Movie -->
        <div class="row">
            <div class="col-md-8">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Search Movie Here.." aria-label="Search"
                        aria-describedby="button-addon2" <% %>>
                    <button class="btn btn-outline-secondary searchButton" type="button"
                        id="button-addon2">Search</button>
                </div>
            </div>
        </div>
        <!-- input Movie -->

        <div class="row movie-container">

        </div>

    </div>
    <%- include('layouts/footer') %>

        <style>
            /* CSS untuk banner utama */
            .swiper-container {
                margin-top: 100px;
                width: 100%;
                display: block;
                height: 84vh;
                overflow-x: hidden;
            }

            .swiper-pagination {
                z-index: 1;
            }

            .swiper-slide img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                object-position: top;
                aspect-ratio: 16/9;
            }

            .swiper-button-next,
            .swiper-button-prev {
                padding: 0px 50px;
                z-index: 1;
            }

            .swiper-button-next i,
            .swiper-button-prev i {
                color: #c7c7c7;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 40px;
                cursor: pointer;
            }

            .swiper-button-prev i:hover {
                color: rgb(199, 252, 120);
            }

            .swiper-button-next i:hover {
                color: rgb(199, 252, 120);
            }

            /* CSS untuk card */
            .swiper-container-card {
                margin: auto;
                margin-bottom: 30px;
                padding-bottom: 80px;
                width: 80%;
                position: relative;
                /* Tambahkan ruang untuk navigasi dan pagination */
                overflow: hidden;
            }

            .swiper-container-card h1 {
                margin: 30px;
                font-weight: 700;
            }

            .swiper-wrapper {
                display: flex;
            }

            .swiper-slide {
                display: flex;
                justify-content: center;
            }

            /* Style card agar sesuai */
            .card {
                width: 18.5rem;
                height: 500px;
                border: none;
                border-radius: 15px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                /* Tambahkan shadow agar lebih menarik */
                transition: transform 0.3s ease-in-out;
            }

            .card img {
                border-radius: 15px;
            }

            .card:hover {
                transform: scale(1.05);
                /* Efek hover pada card */
            }

            .card-img-top {
                width: 100%;
                height: 350px;
                /* Atur tinggi gambar */
                object-fit: cover;
            }

            .card-body {
                text-align: center;
            }

            .card-title {
                font-size: 1rem;
                color: #333;
                margin-top: 10px;
            }


            /* Flexbox untuk tombol navigasi dan pagination */
            .swiper-navigation-wrapper {
                background-color: red;
                display: flex;
                justify-content: center;
                /* Sejajarkan semua item di tengah secara horizontal */
                align-items: center;
                position: absolute;
                bottom: 25px;
                /* Pastikan berada di bagian bawah container */
                width: 100%;
                /* Lebar penuh agar pagination tetap di tengah */
                gap: 20px;
                /* Jarak antara tombol dan pagination */
            }

            .swiper-button-prev::after,
            .swiper-button-next::after {
                content: '';
                /* Kosongkan isi */
            }

            /* Style tombol prev dan next */
            .swiper-button-next-card i,
            .swiper-button-prev-card i {
                color: #0c0a20;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: 45px;
                cursor: pointer;
            }

            /* Style untuk pagination */
            .swiper-pagination-card {
                text-align: center;
                width: auto;
                /* Pagination tidak perlu lebar penuh, biar tetap di tengah */
            }

            .swiper-pagination-bullet {
                background-color: black;
                opacity: 0.8;
                transition: opacity 0.3s;
            }

            .swiper-pagination-bullet-active {
                background-color: red;
                opacity: 1;
            }

            .movie-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                gap: 10px;
                justify-content: center;
            }

            .movie-container a {
                text-decoration: none;
            }

            .card-input {

                border-radius: 20px;
                overflow: hidden;
                border: none;
                border-radius: 15px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                height: 500px;
            }

            .card-input img {
                width: 100%;
                height: 100%;
                display: block;
                object-fit: cover;
            }

            /* Gaya untuk kotak pencarian film */
            .input-group {
                position: relative;
                z-index: 1;
                /* Z-index agar berada di atas elemen lain */
            }

            .form-control {
                border-radius: 20px 0 0 20px;
                border: 2px solid #4A90E2;
                /* Warna tepi */
                padding: 12px 20px;
                font-size: 16px;
                color: #333;
                box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
                /* Bayangan lembut */
                transition: all 0.3s ease;
            }

            .form-control:focus {
                border-color: #8E44AD;
                /* Warna tepi saat fokus */
                box-shadow: 0px 4px 8px rgba(142, 68, 173, 0.3);
                /* Bayangan saat fokus */
                outline: none;
            }

            .searchButton {
                background: linear-gradient(135deg, #4A90E2, #8E44AD);
                /* Gradien warna */
                color: white;
                border-radius: 0 20px 20px 0;
                border: none;
                padding: 12px 20px;
                font-size: 16px;
                font-weight: 600;
                transition: background-color 0.3s ease;
            }

            .searchButton:hover {
                background: linear-gradient(135deg, #8E44AD, #4A90E2);
                /* Ubah gradien saat hover */
                box-shadow: 0px 4px 8px rgba(142, 68, 173, 0.2);
                /* Tambah bayangan saat hover */
            }



            /* Responsif dengan media queries */
            @media (max-width: 1024px) {

                /* Lebar sedang: tablet */
                .swiper-container {
                    height: 70vh;
                }

                .swiper-container-card {
                    width: 85%;
                }

                .card {
                    width: 16rem;
                    height: 400px;
                }

                .card-img-top {
                    height: 300px;
                }
            }

            @media (max-width: 768px) {


                /* Lebar kecil: perangkat mobile dan tablet kecil */
                .swiper-container {
                    height: 60vh;
                    margin-top: 60px
                }

                .swiper-container-card {
                    width: 95%;
                }


                .card {
                    width: 15rem;
                    height: 380px;
                }

                .card-img-top {
                    height: 270px;
                }

                /* Pengaturan navigasi swiper agar lebih kecil */



                .swiper-button-next i,
                .swiper-button-prev i {
                    font-size: 30px;
                    display: none;
                }

                .swiper-button-next-card i,
                .swiper-button-prev-card i {
                    font-size: 40px;
                    display: flex;
                }
            }

            @media (max-width: 480px) {

                /* Lebar sangat kecil: mobile */
                .swiper-container {
                    height: 50vh;
                }

                .swiper-container-card h1 {
                    font-size: 1.5rem;
                    margin: 20px;
                }

                .card {
                    width: 14rem;
                    height: 360px;
                }

                .card-img-top {
                    height: 250px;
                }

                /* Pengaturan navigasi swiper untuk perangkat kecil */
                .swiper-button-next i,
                .swiper-button-prev i,
                .swiper-button-next-card i,
                .swiper-button-prev-card i {
                    font-size: 25px;
                }
            }
        </style>



        <script>



            document.addEventListener('DOMContentLoaded', function () {
                const searchButton = document.querySelector('.searchButton');
                const inputKeyword = document.querySelector('.form-control');


                //highlight
                fetch(`https://api.themoviedb.org/3/discover/movie?api_key=26053bc23c76d5711e30f46f1b46c671&primary_release_year=2024&sort_by=vote_average.desc&vote_count.gte=100
`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(response.statusText)
                        }
                        return response.json()
                    })
                    .then(response => {
                        if (response.Response === 'False') {
                            throw new Error(response.Error)
                        }

                        return updateUi(response.results)
                    })

                if (!searchButton || !inputKeyword) {
                    console.error("Search button or input field is missing!");
                    return;
                }

                searchButton.addEventListener('click', async function () {
                    try {
                        const inputKeyword = document.querySelector('.form-control')
                        const movies = await searchMovie(inputKeyword.value)
                        updateUi(movies)
                    } catch (err) {
                        alert(err)
                    }

                });

                // Fungsi untuk mencari film berdasarkan judul
                async function searchMovie(title) {
                    try {
                        const response = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=26053bc23c76d5711e30f46f1b46c671&language=en-US&query=${encodeURIComponent(title)}&page=1&include_adult=false`);

                        if (!response.ok) {
                            throw new Error(`Error: ${response.statusText}`); // Tangani kesalahan HTTP
                        }

                        const searchResults = await response.json();

                        if (searchResults.total_results === 0) {
                            throw new Error('No movies found');
                        }

                        return searchResults.results; // Mengembalikan hasil pencarian film sebagai array
                    } catch (err) {
                        return err.message; // Mengembalikan pesan error jika terjadi kesalahan
                    }
                }
            });


            function updateUi(movies) {
                const movieContainer = document.querySelector('.movie-container')
                let cards = ''
                movies.forEach(m => cards += showCards(m))
                movieContainer.innerHTML = cards
            }


            function showCards(m) {
                return ` <a href='/search/${m.id}' class="my-3">
                <div class="card-input">
                    <img src="https://image.tmdb.org/t/p/original/${m.poster_path}" class="card-img-top" alt="">
                    <div class="card-body">
                        <h5 class="card-title">${m.title}</h5>
                        <h6 class="card-subtitle mb-2 text-body-secondary">${m.release_date}</h6>
                    
                    </div>
                </div>
            </a>`
            }



            // Swiper untuk banner utama
            const swiper = new Swiper('.swiper-container', {
                loop: true,
                autoplay: {
                    delay: 3000,
                    disableOnInteraction: false,
                },
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                effect: 'fade',
            });

            // Swiper untuk card
            const cardSwiper = new Swiper('.swiper-container-card', {
                slidesPerView: 1, // Tampilkan 3 card sekaligus
                spaceBetween: 20, // Jarak antar card
                loop: true,
                pagination: {
                    el: '.swiper-pagination-card',
                    clickable: true,
                },
                navigation: {
                    nextEl: '.swiper-button-next-card',
                    prevEl: '.swiper-button-prev-card',
                },
                breakpoints: {
                    667: {
                        slidesPerView: 3,
                        spaceBetween: 20,
                    },
                    768: {
                        slidesPerView: 3,
                        spaceBetween: 20,
                    },
                    1024: {
                        slidesPerView: 4,
                        spaceBetween: 30,
                    },
                },
            });

        </script>